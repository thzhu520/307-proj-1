<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit a Report</title>
    <link rel="stylesheet" href="adminall-issues.css">
    <link href="https://fonts.googleapis.com/css2?family=Playpen+Sans:wght@400;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Navbar -->
    <header class="navbar">
        <div class="navbar-logo">
            <a href="issue_admin.html">
                <img src="../icon.png" alt="SLOutions Logo">
            </a>
        </div>
        <nav class="navbar-links">
            <a href="adminabout.html">About Us</a>
            <a href="adminall-issues.html">All Issues</a>
            <a href="adminsubmit-report.html">Submit a Report</a>
            <a href="adminfaq.html">FAQ</a>
        </nav>
        <div class="static-bar">
            <a href="issuemain_admin.html">
                <img src="../staticbar.png" alt="Home Icon" class="static-bar-icon">
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <h1 class="form-title">All Issues</h1>
        <div class="content-container">
            <!-- Dynamically loaded content will appear here -->
        </div>
    </div>

        <script>
      async function fetchReports() {
    try {
        const token = localStorage.getItem('token'); // Ensure token retrieval
        console.log('Token in localStorage:', token);

        if (!token) {
            alert('You must log in first.');
            return;
        }

        // Make the API request
        const response = await fetch('https://sloutions-cugpega6c5efaba4.westus3-01.azurewebsites.net/api/reports?limit=100000', {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            },
        });

        if (!response.ok) {
            throw new Error(`Failed to fetch: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        console.log('API Response:', data); // Debug the response

        // Check if reports exist in the response
        const reports = data.reports || [];
        const contentContainer = document.querySelector('.content-container');

        // Clear the container
        contentContainer.innerHTML = '';

        // Populate the container with report data
        if (reports.length === 0) {
            contentContainer.innerHTML = '<p>No reports found.</p>';
            return;
        }

        reports.forEach(report => {
            const reportCard = document.createElement('div');
            reportCard.classList.add('issue-card');
            reportCard.innerHTML = `
                <p><strong>Title:</strong> ${report.title}</p>
                <p><strong>Location:</strong> ${report.location}</p>
                <p><strong>Description:</strong> ${report.description}</p>
                <p><strong>Date:</strong> ${new Date(report.createdDate).toLocaleString()}</p>
                <p><strong>Status:</strong> ${report.status}</p>
            `;
            contentContainer.appendChild(reportCard);
        });
    } catch (error) {
        console.error('Error fetching reports:', error);
        document.querySelector('.content-container').innerHTML = `<p>Error loading reports: ${error.message}</p>`;
    }
}

// Run the function when the DOM content is fully loaded
document.addEventListener('DOMContentLoaded', fetchReports);


            </script>
            
    </body>

    </html>
